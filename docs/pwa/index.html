<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>PWA (Progressive Web Apps) | 毛苏徽的博客空间</title>
    <meta name="generator" content="VuePress 1.8.1">
    <link rel="icon" href="/avatar.png">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <meta name="author" content="shmao">
    <meta name="theme-color" content="#42b983">
    
    <link rel="preload" href="/assets/css/0.styles.2947e653.css" as="style"><link rel="preload" href="/assets/js/app.d8bdd170.js" as="script"><link rel="preload" href="/assets/js/2.7f46725b.js" as="script"><link rel="preload" href="/assets/js/6.da8618bd.js" as="script"><link rel="prefetch" href="/assets/js/10.3d461e36.js"><link rel="prefetch" href="/assets/js/11.affa1660.js"><link rel="prefetch" href="/assets/js/12.dd580ba6.js"><link rel="prefetch" href="/assets/js/13.6c849129.js"><link rel="prefetch" href="/assets/js/14.d9e850fd.js"><link rel="prefetch" href="/assets/js/15.c35582a6.js"><link rel="prefetch" href="/assets/js/16.a1b90152.js"><link rel="prefetch" href="/assets/js/17.2fa12a19.js"><link rel="prefetch" href="/assets/js/18.5cdd7cd8.js"><link rel="prefetch" href="/assets/js/19.791dceb6.js"><link rel="prefetch" href="/assets/js/20.96f1b917.js"><link rel="prefetch" href="/assets/js/3.4c6b4054.js"><link rel="prefetch" href="/assets/js/4.fee3b5c8.js"><link rel="prefetch" href="/assets/js/5.5ab88dc3.js"><link rel="prefetch" href="/assets/js/7.73f9b616.js"><link rel="prefetch" href="/assets/js/8.ac30967f.js"><link rel="prefetch" href="/assets/js/9.188bd33f.js">
    <link rel="stylesheet" href="/assets/css/0.styles.2947e653.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/avatar.png" alt="毛苏徽的博客空间" class="logo"> <span class="site-name can-hide">毛苏徽的博客空间</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/guide/" class="nav-link">
  导航
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="博客" class="dropdown-title"><span class="title">博客</span> <span class="arrow down"></span></button> <button type="button" aria-label="博客" class="mobile-dropdown-title"><span class="title">博客</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Javascript
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/docs/javascript/oop/" class="nav-link">
  面向对象
</a></li></ul></li><li class="dropdown-item"><!----> <a href="/docs/vue/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/docs/pwa/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  PWA
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="语言" class="dropdown-title"><span class="title">语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="语言" class="mobile-dropdown-title"><span class="title">语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/language/chinese.html" class="nav-link">
  中文
</a></li><li class="dropdown-item"><!----> <a href="/language/english.html" class="nav-link">
  英文
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/shmao-0428" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/guide/" class="nav-link">
  导航
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="博客" class="dropdown-title"><span class="title">博客</span> <span class="arrow down"></span></button> <button type="button" aria-label="博客" class="mobile-dropdown-title"><span class="title">博客</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Javascript
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/docs/javascript/oop/" class="nav-link">
  面向对象
</a></li></ul></li><li class="dropdown-item"><!----> <a href="/docs/vue/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/docs/pwa/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  PWA
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="语言" class="dropdown-title"><span class="title">语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="语言" class="mobile-dropdown-title"><span class="title">语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/language/chinese.html" class="nav-link">
  中文
</a></li><li class="dropdown-item"><!----> <a href="/language/english.html" class="nav-link">
  英文
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/shmao-0428" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="pwa-progressive-web-apps"><a href="#pwa-progressive-web-apps" class="header-anchor">#</a> PWA (Progressive Web Apps)</h1> <h2 id="初识pwa"><a href="#初识pwa" class="header-anchor">#</a> 初识PWA</h2> <p>webapp用户体验差（不能离线访问），用户粘性低（无法保存入口），pwa就是为了解决这一系列问题（Progressive Web Apps）,让webapp具有快速，可靠，安全等特点.</p> <p><strong>PWA一系列用到的技术</strong></p> <ul><li>Web App Manifest</li> <li>Service Worker</li> <li>Push Api &amp; Notification Api</li> <li>Promise</li> <li>CacheStorage</li></ul> <h3 id="一-web-app-manifest"><a href="#一-web-app-manifest" class="header-anchor">#</a> 一.<code>Web App Manifest</code></h3> <p>将网站添加到桌面、更类似native的体验</p> <p><strong>Web App Manifest设置</strong></p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>manifest<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/manifest.json<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;PWA效果展示&quot;</span><span class="token punctuation">,</span>  <span class="token comment">// 应用名称 </span>
    <span class="token property">&quot;short_name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;PWA&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 桌面应用的名称  ✓</span>
    <span class="token property">&quot;display&quot;</span><span class="token operator">:</span> <span class="token string">&quot;standalone&quot;</span><span class="token punctuation">,</span> <span class="token comment">// fullScreen (standalone) minimal-ui browser ✓</span>
    <span class="token property">&quot;start_url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 打开时的网址  ✓</span>
    <span class="token property">&quot;icons&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token comment">// 设置桌面图片 icon图标</span>
        <span class="token property">&quot;src&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/icon.png&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;sizes&quot;</span><span class="token operator">:</span> <span class="token string">&quot;144x144&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;image/png&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;background_color&quot;</span><span class="token operator">:</span> <span class="token string">&quot;#aaa&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 启动画面颜色</span>
    <span class="token property">&quot;theme_color&quot;</span><span class="token operator">:</span> <span class="token string">&quot;#aaa&quot;</span> <span class="token comment">// 状态栏的颜色</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>ios 不支持 <code>manifest</code>文件，可以通过 meta/link 私有属性进行设置</p></blockquote> <div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!-- 图标icon --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>apple-touch-icon<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/icon.png<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token comment">&lt;!-- 添加到主屏后的标题 和 short_name一致 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>apple-mobile-web-app-title<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>标题<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span> 
<span class="token comment">&lt;!-- 隐藏safari地址栏 standalone模式下默认隐藏 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>apple-mobile-web-app-capable<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>yes<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span> 
<span class="token comment">&lt;!-- 设置状态栏颜色 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>apple-mobile-web-app-status-bar-style<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>black-translucent<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span> 
</code></pre></div><h3 id="二-service-worker"><a href="#二-service-worker" class="header-anchor">#</a> 二.<code>Service Worker</code></h3> <p><strong>Service Worker特点：</strong></p> <ul><li>不能访问／操作dom</li> <li>会自动休眠，不会随浏览器关闭所失效(必须手动卸载)</li> <li>离线缓存内容开发者可控</li> <li>必须在https或者localhost下使用</li> <li>所有的api都基于promise</li></ul> <p><strong>生命周期</strong></p> <ul><li>安装( installing )：这个状态发生在 Service Worker 注册之后，表示开始安装，触发 install 事件回调指定一些静态资源进行离线缓存。</li> <li>安装后( installed )：Service Worker 已经完成了安装，并且等待其他的 Service Worker 线程被关闭。</li> <li>激活( activating )：在这个状态下没有被其他的 Service Worker 控制的客户端，允许当前的 worker 完成安装，并且清除了其他的 worker 以及关联缓存的旧缓存资源，等待新的 Service Worker 线程被激活。</li> <li>激活后( activated )：在这个状态会处理 activate 事件回调 (提供了更新缓存策略的机会)。并可以处理功能性的事件 fetch (请求)、sync (后台同步)、push (推送)。</li> <li>废弃状态 ( redundant )：这个状态表示一个 Service Worker 的生命周期结束。</li></ul> <p><strong>关键方法</strong></p> <ul><li>self.skipWaiting():表示强制当前处在 waiting 状态的 Service Worker 进入 activate 状态</li> <li>event.waitUntil()：传入一个 Promise 为参数，等到该 Promise 为 resolve 状态为止。</li> <li>self.clients.claim()：在 activate 事件回调中执行该方法表示取得页面的控制权, 这样之后打开页面都会使用版本更新的缓存。旧的 Service Worker 脚本不再控制着页面，之后会被停止。</li></ul> <blockquote><p>下载准备好的服务端代码: <a href="https://gitee.com/jw-speed/pwa-prepare" target="_blank" rel="noopener noreferrer">PWA准备<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>width=device-width, initial-scale=1.0<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>stylesheet<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/index.css<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>manifest<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/manifest.json<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>PWA 效果展示<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/main.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><blockquote><p>页面中分别引入 css、js文件 及引入manifest.json</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> ul <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'ul'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/api/list'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    data<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> li <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> img <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'img'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        img<span class="token punctuation">.</span>src <span class="token operator">=</span> item<span class="token punctuation">;</span>
        li<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span><span class="token punctuation">;</span>
        ul<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>li<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><blockquote><p>main.js中会调用服务端接口获取数据进行页面渲染。</p></blockquote> <blockquote><p>我们核心要实现：实现离线访问功能、并离线缓存接口数据！</p></blockquote> <h3 id="_1-注册serviceworker"><a href="#_1-注册serviceworker" class="header-anchor">#</a> 1）注册serviceWorker</h3> <div class="language-js extra-class"><pre class="language-js"><code>window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'load'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">'serviceWorker'</span> <span class="token keyword">in</span> navigator<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> registration <span class="token operator">=</span> <span class="token keyword">await</span> navigator<span class="token punctuation">.</span>serviceWorker<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">'/sw.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>registration<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>我们需要等待主线程加载完毕，在注册<code>serviceWorker</code>。由于单开一条线程是有资源消耗的，我们并不希望，<code>serviceWorker</code>的开启影响页面的加载</p></blockquote> <h3 id="_2-注册监听函数"><a href="#_2-注册监听函数" class="header-anchor">#</a> 2）注册监听函数</h3> <div class="language-js extra-class"><pre class="language-js"><code>self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'fetch'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>request<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 拦截请求</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'install'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    e<span class="token punctuation">.</span><span class="token function">waitUntil</span><span class="token punctuation">(</span><span class="token function">skipWaiting</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 跳过等待，直接激活</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'activate'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    e<span class="token punctuation">.</span><span class="token function">waitUntil</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>clients<span class="token punctuation">.</span><span class="token function">claim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 让serviceWorker拥有控制权</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_3-缓存静态资源"><a href="#_3-缓存静态资源" class="header-anchor">#</a> 3）缓存静态资源</h3> <p><strong>安装时将缓存列表进行缓存操作</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token constant">CACHE_NAME</span> <span class="token operator">=</span> <span class="token string">'cache_v'</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">CACHE_LIST</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string">'/'</span><span class="token punctuation">,</span>
    <span class="token string">'/index.css'</span><span class="token punctuation">,</span>
    <span class="token string">'/main.js'</span><span class="token punctuation">,</span>
    <span class="token string">'/api/list'</span><span class="token punctuation">,</span>
    <span class="token string">'/index.html'</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">preCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> cache <span class="token operator">=</span> <span class="token keyword">await</span> caches<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token constant">CACHE_NAME</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> cache<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span><span class="token constant">CACHE_LIST</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> self<span class="token punctuation">.</span><span class="token function">skipWaiting</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'install'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    e<span class="token punctuation">.</span><span class="token function">waitUntil</span><span class="token punctuation">(</span><span class="token function">preCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 跳过等待，直接激活</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>激活后删除无用的缓存</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">clearCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    self<span class="token punctuation">.</span>clients<span class="token punctuation">.</span><span class="token function">claim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> keys <span class="token operator">=</span> <span class="token keyword">await</span> caches<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>keys<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>key <span class="token operator">!==</span> <span class="token constant">CACHE_NAME</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> caches<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'activate'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    e<span class="token punctuation">.</span><span class="token function">waitUntil</span><span class="token punctuation">(</span><span class="token function">clearCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 让serviceWorker拥有控制权</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_4-离线使用缓存"><a href="#_4-离线使用缓存" class="header-anchor">#</a> 4）离线使用缓存</h3> <div class="language-js extra-class"><pre class="language-js"><code>self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'fetch'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>request<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>url<span class="token punctuation">.</span>origin <span class="token operator">!==</span> self<span class="token punctuation">.</span>origin<span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// 静态资源走浏览器缓存</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    e<span class="token punctuation">.</span><span class="token function">respondWith</span><span class="token punctuation">(</span>
        <span class="token function">fetch</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> caches<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_5-缓存策略"><a href="#_5-缓存策略" class="header-anchor">#</a> 5）缓存策略</h3> <p><a href="https://developers.google.com/web/tools/workbox" target="_blank" rel="noopener noreferrer">基于workbox 缓存类型<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <ul><li>cachefirst 缓存优先</li> <li>cacheonly 仅缓存</li> <li>networkfirst 网络优先</li> <li>networkonly 仅网络</li> <li>StaleWhileRevalidate 从缓存取，用网络数据更新缓存</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">fetchAndSave</span><span class="token punctuation">(</span><span class="token parameter">req</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">fetch</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token keyword">let</span> cloneRes <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        caches<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token constant">CACHE_NAME</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">cache</span><span class="token operator">=&gt;</span>cache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span>cloneRes<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> res<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'fetch'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>request<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>url<span class="token punctuation">.</span>origin <span class="token operator">!==</span> self<span class="token punctuation">.</span>origin<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
	<span class="token comment">// 从缓存取，用网络数据更新缓存</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>request<span class="token punctuation">.</span>url<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'/api'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> e<span class="token punctuation">.</span><span class="token function">respondWith</span><span class="token punctuation">(</span>
            <span class="token function">fetchAndSave</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                <span class="token keyword">return</span> caches<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    e<span class="token punctuation">.</span><span class="token function">respondWith</span><span class="token punctuation">(</span>
        <span class="token function">fetch</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> caches<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p><code>serviceWorker</code>文件发生变化，会自动重新注册</p></blockquote> <h3 id="三-push-api"><a href="#三-push-api" class="header-anchor">#</a> 三.<code>Push Api</code></h3> <p><a href="https://tools.ietf.org/html/draft-ietf-webpush-protocol-12" target="_blank" rel="noopener noreferrer">Web Push Protocol<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/PushManager/subscribe" target="_blank" rel="noopener noreferrer">PushManager.subscribe<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://github.com/alienzhou/learning-pwa/tree/push/public" target="_blank" rel="noopener noreferrer">leaning-pwa<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://www.jianshu.com/p/9970a9340a2d" target="_blank" rel="noopener noreferrer">【PWA学习与实践】(5) 使用Push API实现消息推送<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-text extra-class"><pre class="language-text"><code> +-------+           +--------------+       +-------------+
 |  UA   |           | Push Service |       | Application |
 +-------+           +--------------+       |   Server    |
     |                      |               +-------------+
     |      Subscribe       |                      |
     |---------------------&gt;|                      |
     |       Monitor        |                      |
     |&lt;====================&gt;|                      |
     |                      |                      |
     |          Distribute Push Resource           |
     |--------------------------------------------&gt;|
     |                      |                      |
     :                      :                      :
     |                      |     Push Message     |
     |    Push Message      |&lt;---------------------|
     |&lt;---------------------|                      |
     |                      |                      |
</code></pre></div><h3 id="_1-核心实现流程"><a href="#_1-核心实现流程" class="header-anchor">#</a> 1）核心实现流程</h3> <ul><li><code>Subscribe</code>: 向Push Service发起订阅，获取<code>PushSubscription</code></li> <li><code>Monitor</code>: 实现浏览器和PushService通信 （用户离线，PushSevice会维护消息列表）</li> <li><code>Distribute Push Resource</code>: 将<code>PushSubscription</code> 交给服务器，用于通信</li> <li><code>Push Message</code>: 服务端将消息推送给 <code>Push Service</code>。 <code>Push Service</code>在推送给对应的客户端</li></ul> <h3 id="_2-实现服务端推送"><a href="#_2-实现服务端推送" class="header-anchor">#</a> 2）实现服务端推送</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">urlBase64ToUint8Array</span><span class="token punctuation">(</span><span class="token parameter">base64String</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> padding <span class="token operator">=</span> <span class="token string">'='</span><span class="token punctuation">.</span><span class="token function">repeat</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">4</span> <span class="token operator">-</span> base64String<span class="token punctuation">.</span>length <span class="token operator">%</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> base64 <span class="token operator">=</span> <span class="token punctuation">(</span>base64String <span class="token operator">+</span> padding<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">-</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">'+'</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">_</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> rawData <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">atob</span><span class="token punctuation">(</span>base64<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> outputArray <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span>rawData<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> rawData<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        outputArray<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> rawData<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> outputArray<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> publicKey <span class="token operator">=</span> <span class="token string">'BKn9WZWSFKaRlWfxwg32xV5M_IYr_nUFRQnS8tb_fR_1X1Ga_xP2TGfObHtKZzDeVBSJfoNasD_-N5qnYyg5enc'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> convertedVapidKey <span class="token operator">=</span> <span class="token function">urlBase64ToUint8Array</span><span class="token punctuation">(</span>publicKey<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 通过公钥通信确保安全, 类型要求是ArrayBuffer</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code>window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'load'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">'serviceWorker'</span> <span class="token keyword">in</span> navigator<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> registration <span class="token operator">=</span> <span class="token keyword">await</span> navigator<span class="token punctuation">.</span>serviceWorker<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">'/sw.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 等待serviceWorker激活后</span>
        <span class="token keyword">await</span> navigator<span class="token punctuation">.</span>serviceWorker<span class="token punctuation">.</span>ready<span class="token punctuation">;</span>
        <span class="token keyword">let</span> pushSubsription <span class="token operator">=</span> <span class="token keyword">await</span> registration<span class="token punctuation">.</span>pushManager<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            userVisibleOnly<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            applicationServerKey<span class="token operator">:</span> convertedVapidKey
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 服务器这是我的通信对象</span>
        <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/add-sub'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
            headers<span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token string">&quot;Content-Type&quot;</span><span class="token operator">:</span> <span class="token string">'application/json'</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            method<span class="token operator">:</span> <span class="token string">'post'</span><span class="token punctuation">,</span>
            body<span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>pushSubsription<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>服务端获取对象后，可以直接给我们的客户端推送消息了</p></blockquote> <h3 id="四-notification"><a href="#四-notification" class="header-anchor">#</a> 四.<code>Notification</code></h3> <p>在<code>ServieWorker</code>中监听服务端推送的消息</p> <div class="language-js extra-class"><pre class="language-js"><code>self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'push'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> data <span class="token operator">=</span> e<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        self<span class="token punctuation">.</span>registration<span class="token punctuation">.</span><span class="token function">showNotification</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        
    <span class="token punctuation">}</span>  <span class="token keyword">else</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'push没有任何数据'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>可以实现<code>APP</code>中信息推送的功能，当然可以直接使用<code>Notification API</code> ，但是大部分情况，我们还是会配合<code>Push Api</code>进行使用</p></blockquote> <h4 id="notification-api"><a href="#notification-api" class="header-anchor">#</a> Notification API</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 通知</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>Notification<span class="token punctuation">.</span>permission <span class="token operator">===</span> <span class="token string">'default'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Notification<span class="token punctuation">.</span><span class="token function">requestPermission</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>navigator<span class="token punctuation">.</span>onLine<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">new</span> <span class="token class-name">Notification</span><span class="token punctuation">(</span><span class="token string">'提示'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        body<span class="token operator">:</span> <span class="token string">'网络断开, 当前网络不可访问'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'online'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">new</span> <span class="token class-name">Notification</span><span class="token punctuation">(</span><span class="token string">'提示'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        body<span class="token operator">:</span> <span class="token string">'网络连接, 通信正常使用'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'offline'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">new</span> <span class="token class-name">Notification</span><span class="token punctuation">(</span><span class="token string">'提示'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        body<span class="token operator">:</span> <span class="token string">'网络断开, 当前网络不可访问'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="参考链接"><a href="#参考链接" class="header-anchor">#</a> 参考链接</h3> <ol><li><a href="https://www.cnblogs.com/shihaiming/p/6277505.html" target="_blank" rel="noopener noreferrer">简单了解HTML5中的Web Notification桌面通知<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/notification" target="_blank" rel="noopener noreferrer">notification<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.cnblogs.com/bigbearbb/p/4299003.html" target="_blank" rel="noopener noreferrer">大熊君学习html5系列之------Online &amp;&amp; Offline（在线状态检测）<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ol> <h2 id="pwa-实践案例"><a href="#pwa-实践案例" class="header-anchor">#</a> PWA 实践案例</h2> <h3 id="_1-注册manifest-json"><a href="#_1-注册manifest-json" class="header-anchor">#</a> 1. 注册manifest.json</h3> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;manifest_version&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Music Pwa&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Music Pwa&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;short_name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Music Pwa&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;display&quot;</span><span class="token operator">:</span> <span class="token string">&quot;standalone&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;start_url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;icons&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;src&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/assets/icon.png&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;sizes&quot;</span><span class="token operator">:</span> <span class="token string">&quot;144x144&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;image/png&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;background_color&quot;</span><span class="token operator">:</span> <span class="token string">&quot;aqua&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;theme_color&quot;</span><span class="token operator">:</span> <span class="token string">&quot;aqua&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_2-sw-js"><a href="#_2-sw-js" class="header-anchor">#</a> 2. sw.js</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token constant">CACHE_NAME</span> <span class="token operator">=</span> <span class="token string">&quot;cache_v1&quot;</span>
<span class="token keyword">const</span> <span class="token constant">CACHE</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token comment">// 默认本地localhost:8080</span>
    <span class="token string">'/index.html'</span><span class="token punctuation">,</span>
    <span class="token string">'/src/index.js'</span><span class="token punctuation">,</span>
    <span class="token string">'/src/style.css'</span><span class="token punctuation">,</span>
    <span class="token string">'/assets/icon.png'</span><span class="token punctuation">,</span>
    <span class="token string">'/api/search?keywords=%E6%B5%B7%E9%98%94%E5%A4%A9%E7%A9%BA'</span><span class="token punctuation">,</span>
    <span class="token string">'/api/comment/music?id=186016&amp;limit=1'</span><span class="token punctuation">,</span>
    <span class="token string">'/main.js'</span><span class="token punctuation">,</span> <span class="token comment">// webpack打包后入口文件名称</span>
    <span class="token string">'/manifest.json'</span>
<span class="token punctuation">]</span>
self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'install'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 缓存内容</span>
    <span class="token keyword">const</span> cache <span class="token operator">=</span> <span class="token keyword">await</span> caches<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token constant">CACHE_NAME</span><span class="token punctuation">)</span>
    <span class="token keyword">await</span> cache<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span><span class="token constant">CACHE</span><span class="token punctuation">)</span>
    <span class="token comment">// e.waitUntil(skipWaiting())</span>
    <span class="token keyword">await</span> self<span class="token punctuation">.</span><span class="token function">skipWaiting</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'activate'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 清除其他缓存</span>
    <span class="token keyword">const</span> keys <span class="token operator">=</span> <span class="token keyword">await</span> caches<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    keys<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">key</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token operator">!==</span> <span class="token constant">CACHE_NAME</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            caches<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">// e.waitUntil(self.clients.claim())</span>
    <span class="token keyword">await</span> self<span class="token punctuation">.</span>clients<span class="token punctuation">.</span><span class="token function">claim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'fetch'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// console.log(e.request.url);</span>
    <span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>request<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 只缓存同源的</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>url<span class="token punctuation">.</span>origin <span class="token operator">!==</span> self<span class="token punctuation">.</span>origin<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 从缓存取，用网络数据更新缓存</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>request<span class="token punctuation">.</span>url<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'/api'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// networkFirst(e.request)</span>
        <span class="token keyword">return</span> e<span class="token punctuation">.</span><span class="token function">respondWith</span><span class="token punctuation">(</span>
            <span class="token function">fetchAndSave</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> caches<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    e<span class="token punctuation">.</span><span class="token function">respondWith</span><span class="token punctuation">(</span>
        <span class="token comment">// cacheFirst(e.request)</span>
        <span class="token function">fetch</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> ret <span class="token operator">=</span> <span class="token keyword">await</span> caches<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>request<span class="token punctuation">)</span>
            <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// ! 方式一</span>
<span class="token comment">// cache优先. 适用于静态资源</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">cacheFirst</span> <span class="token punctuation">(</span><span class="token parameter">req</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> cache <span class="token operator">=</span> <span class="token keyword">await</span> caches<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token constant">CACHE_NAME</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> cached <span class="token operator">=</span> <span class="token keyword">await</span> cache<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> cached <span class="token operator">||</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 网络优先的数据, 如果我们获取到了数据, 应该往缓存中存一份</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">networkFirst</span> <span class="token punctuation">(</span><span class="token parameter">req</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> cache <span class="token operator">=</span> <span class="token keyword">await</span> caches<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token constant">CACHE_NAME</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> fresh <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 网络优先 获取到的数据 应该再次更新到缓存</span>
        <span class="token comment">// 把响应的备份存储到缓存中</span>
        cache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> fresh<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> fresh<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> cached <span class="token operator">=</span> <span class="token keyword">await</span> cache<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> cached<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token comment">// ! 方式二</span>
<span class="token keyword">function</span> <span class="token function">fetchAndSave</span> <span class="token punctuation">(</span><span class="token parameter">req</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">fetch</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> cloneRes <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        caches<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token constant">CACHE_NAME</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">cache</span> <span class="token operator">=&gt;</span> cache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> cloneRes<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> res<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_3-注册pwa桌面应用"><a href="#_3-注册pwa桌面应用" class="header-anchor">#</a> 3. 注册PWA桌面应用</h3> <p><img src="data:image/png;base64,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" alt=""></p> <h3 id="_4-相关api参考链接"><a href="#_4-相关api参考链接" class="header-anchor">#</a> 4. 相关api参考链接</h3> <ol><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Service_Worker_API" target="_blank" rel="noopener noreferrer">Service Worker API - Web API 接口参考 | MDN - Mozilla<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://developer.mozilla.org/zh-CN/docs/Web/Manifest" target="_blank" rel="noopener noreferrer">Web App Manifest | MDN - Mozilla<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/CacheStorage" target="_blank" rel="noopener noreferrer">CacheStorage - Web API 接口参考 | MDN<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/notification" target="_blank" rel="noopener noreferrer">notification - Web API 接口参考 | MDN<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Workers_API/Using_web_workers" target="_blank" rel="noopener noreferrer">使用 Web Workers - Web API 接口参考 | MDN<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ol> <h3 id="_5-项目地址"><a href="#_5-项目地址" class="header-anchor">#</a> 5. 项目地址</h3> <ol><li><a href="https://github.com/shmao-0428/shmao-markdown/tree/master/PWA/music-pwa" target="_blank" rel="noopener noreferrer">music-pwa<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://github.com/Binaryify/NeteaseCloudMusicApi" target="_blank" rel="noopener noreferrer">NeteaseCloudMusicApi<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://gitee.com/jw-speed/pwa-prepare" target="_blank" rel="noopener noreferrer">pwa-prepare<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ol></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">2/13/2021, 11:37:35 PM</span></div></footer> <!----> </main></div><div class="global-ui"><!----><div id="live2d-widget" class="live2d-widget-container" style="position:fixed;right:65px;bottom:0px;width:135px;height:300px;z-index:99999;opacity:0.8;pointer-events:none;"><canvas id="live2d_canvas" width="135" height="300" class="live2d_canvas" style="position:absolute;left:0px;top:0px;width:135px;height:300px;"></canvas></div><!----></div></div>
    <script src="/assets/js/app.d8bdd170.js" defer></script><script src="/assets/js/2.7f46725b.js" defer></script><script src="/assets/js/6.da8618bd.js" defer></script>
  </body>
</html>
